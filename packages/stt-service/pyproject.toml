[project]
name = "stt-service"
version = "0.4.0"
description = "AEO Push-to-Talk - GPU-accelerated speech-to-text for Linux"
readme = "README.md"
license = "MIT"
requires-python = ">=3.12.3"
dependencies = [
    "onnx-asr>=0.10.0",  # API changed in 0.10 (path= parameter)
    "huggingface_hub>=0.20.0",  # Required by onnx-asr for model downloads (not declared)
    # NOTE: onnx-asr depends on onnxruntime. For GPU support, install onnxruntime-gpu
    # separately: pip install onnxruntime-gpu (replaces onnxruntime)
    "websockets>=13.0",
    "sounddevice>=0.5.0",
    "numpy>=2.0.0",
    "pydantic>=2.0.0",
    "pydantic-settings>=2.0.0",
]

[project.optional-dependencies]
gpu = [
    # PyPI onnxruntime-gpu doesn't have ARM64 wheels
    # For ARM64 (GB10/DGX Spark), see README for manual installation
    "onnxruntime-gpu>=1.18.0; platform_machine != 'aarch64'",
]
gpu-arm64 = [
    # ARM64 GPU requires manual wheel installation from Ultralytics
    # pip install https://github.com/ultralytics/assets/releases/download/v0.0.0/onnxruntime_gpu-1.24.0-cp312-cp312-linux_aarch64.whl
]
ptt = [
    # Push-to-Talk mode requires evdev for global hotkey capture (Linux only)
    # User must have read access to /dev/input/event* (add to 'input' group)
    "evdev>=1.7.0; sys_platform == 'linux'",
]
desktop = [
    # Combined dependencies for daemon mode with system tray
    # Includes evdev for global hotkey + pystray/pillow for tray indicator
    "evdev>=1.7.0; sys_platform == 'linux'",
    "pystray>=0.19.0",
    "pillow>=10.0.0",
]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
]

[project.scripts]
stt-server = "stt_service.server:main"
stt-client = "stt_service.client:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["src/stt_service"]

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
